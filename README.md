# doubledecker
Сервис для загрузки презентаций и расшаривания их онлайн.
Аналог slideshare.net и speakerdeck.com

## Принцип работы
1. PDF-файл загружается (на данный момент — через Telegram-бота)
2. Если загруженный файл — PDF, страницы извлекаются в виде PNG-изображений
2а. Если в системе доступен `optipng` (и в .env активирована его поддержка), полученные PNG-изображения подвергаются жёсткой оптимизации
3. Пользователю генерируется ссылка для просмотра онлайн и html-код для встраивания слайдшоу на любой сторонний сайт.

## Зависимости
1. `python-telegram-bot` — очевидно, для чего
2. `python-decouple` — для работы с .env-конфигом
3. `pymupdf` — для конвертации PDF, работы с его страницами
4. `filetype` — для проверки загруженного файла (а PDF ли…)
5. `peewee` — ORM для работы с базой данных
6. `Flask` — веб-интерфейс (на данный момент обслуживает страницы просмотра и встраивания слайдов)
7. [smally V0.50 by xinlin-z](https://github.com/xinlin-z/smally) — интерфейс для оптимизации изображений (обёртка над `optipng`, не собран в пакет — поэтому включён «как есть», авторство бережно указано, почести [@xinlin-z](https://github.com/xinlin-z/) возданы)

## Инструкция по запуску
1. Установить зависимости (`pip install -r requirements.txt`)
2. Скопировать файл `.env-sample` в `.env`, отредактировать опции под себя (токен бота, путь для загрузки PDF, путь к sqlite-базе, адрес веб-сервера, наличие opting)
3. Создать схему БД (`python data-models.py`)
4. Запустить бота (`python bot.py`)
5. Запустить тестовый веб-сервер (`flask --app webview run`)

## Перспективы развития
1. Добавить проверку статуса опубликованности презентаций в базе данных, альтернативные статусы («временно заблокировано», «ожидает модерации» и т.п.)
2. Добавить возможность модерации через Telegram
3. Добавить возможность загрузки и управления презентациями через веб-интерфейс
4. Вынести статику из-под Flask во внешний веб-сервер (nginx)
5. Сделать более аккуратные сообщения об ошибках в процессе загрузки/обработки презентаций.
6. Добавить поддержку oEmbed.

...

7. Запустить в продакшн — как минимум, для себя).
